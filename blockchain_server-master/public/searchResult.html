
<!DOCTYPE html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js"> <!--<![endif]-->
	<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<title>搜索结果</title>
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta name="description" content="Free HTML5 Template by FREEHTML5" />
	<meta name="keywords" content="free html5, free template, free bootstrap, html5, css3, mobile first, responsive" />
	
  	<!-- Facebook and Twitter integration -->
	<meta property="og:title" content=""/>
	<meta property="og:image" content=""/>
	<meta property="og:url" content=""/>
	<meta property="og:site_name" content=""/>
	<meta property="og:description" content=""/>
	<!-- Place favicon.ico and apple-touch-icon.png in the root directory -->
	<link rel="shortcut icon" href="favicon.ico">

	<!-- <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,700,300' rel='stylesheet' type='text/css'> -->
	
	<!-- Animate.css -->
	<link rel="stylesheet" href="css/animate.css">
	<!-- Icomoon Icon Fonts-->
	<link rel="stylesheet" href="css/icomoon.css">
	<!-- Bootstrap  -->
	<link rel="stylesheet" href="css/bootstrap.css">
	<!-- Superfish -->
	<link rel="stylesheet" href="css/superfish.css">

	<link rel="stylesheet" href="css/style.css">


	<!-- Modernizr JS -->
	<script src="js/modernizr-2.6.2.min.js"></script>
	<!-- FOR IE9 below -->
	<!--[if lt IE 9]>
	<script src="js/respond.min.js"></script>
	<![endif]-->
    <!-- jQuery -->


  <script src="js/jquery.min.js"></script>
  <!-- jQuery Easing -->
  <script src="js/jquery.easing.1.3.js"></script>
  <!-- Bootstrap -->
  <script src="js/bootstrap.min.js"></script>
  <!-- Waypoints -->
  <script src="js/jquery.waypoints.min.js"></script>
  <!-- Stellar -->
  <script src="js/jquery.stellar.min.js"></script>
  <!-- Superfish -->
  <script src="js/hoverIntent.js"></script>
  <script src="js/superfish.js"></script>

  <!-- Main JS -->
  <script src="js/main.js"></script>
	</head>
	<body>
		<div id="fh5co-wrapper">
		<div id="fh5co-page">
		<div id="fh5co-header">
			<header id="fh5co-header-section" class="head-overlay">
				<div class="container">
					<div class="nav-header">
						<a href="#" class="js-fh5co-nav-toggle fh5co-nav-toggle"><i></i></a>
						<h4 id="fh5co-logo"><a href="index.html">医疗区块链<span class="glyphicon glyphicon-cloud-download"></span></a></h4>
						<!-- START #fh5co-menu-wrap -->
						<nav id="fh5co-menu-wrap" role="navigation">
							<ul class="sf-menu" id="fh5co-primary-menu">
								<li class="active">
									<a href="index.html">主页</a></i>
								</li>
								<li><a href="about.html">关于我们</a></li>
								<li><a href="login.html" class="fh5co-sub-ddown">个人中心</a>
								  <ul class="fh5co-sub-menu"><li><a href="#/preview/?item=build-free-html5-bootstrap-template" target="_blank">个人信息</a></li><li><a href="#/preview/?item=work-free-html5-template-bootstrap" target="_blank">退出</a></li></ul>
								</li>
							</ul>
						</nav>
					</div>
				</div>
			</header>		
		</div>	
		<!-- fh5co-content-section开始看 -->
		<div id="fh5co-services-section">
    <div class="container block1"><h1>A</h1></div>
          <div class="container"><h4 id="test">你好！<i id="#" class="glyphicon glyphicon-cloud"></i><b><span id="mtname"></span></b></h4></div>
          <script>
                      document.write('<ul class="pager"><li><a style="color:#ffffff;background:#7ad88f" href="#" onclick="javascript :history.back(-1);">返回至查询</a ></li></ul>');
                      </script>
          <div id="requestHandle" class="container">
                <div class="col-md-8 col-md-offset-2 heading-section animate-box">
                        <br/><br/>
                        <div id="search11"></br>    
            <h4  class="text-center">搜索结果</h4>
            <div id="searchResult">
            <script type="text/javascript">
              $(document).ready(function(){
                function getCookie(objName){//获取指定名称的cookie的值   
                    var arrStr = document.cookie.split("; ");   
                    for (var i = 0; i < arrStr.length; i++) {   
                        var temp = arrStr[i].split("=");   
                        if (temp[0] == objName)   
                            return unescape(temp[1]);   
                    }   
                }
                var tname=getCookie("tname");
                if(tname==""){
                  window.location.href="login.html";
                }
                $("#mtname").html(tname);
                var thisURL = document.URL;    
                var getval =thisURL.split('?')[1];  
                var reason= getval.split("=")[1];
                var postBody = {
                    reason:reason
                };
                $.ajax({
                type: 'POST',
                url: 'http://localhost:3389/check/third/query/data',
                data: postBody,
                dataType: 'json',
                success: function(data){
                  //$("暂无满足要求的数据").appendTo("#searchResult");
                    console.log("ajax"+JSON.stringify(data));
                    function getJsonLength(jsonData){
                      var jsonLength = 0;
                      for(var item in jsonData){
                        jsonLength++;
                      }
                      return jsonLength;
                    }
                    var jsonLength=getJsonLength(data);
                    for(var o in data){  
                        $('<br>病例Id:<span id="_id'+o+'">'+data[o]._id+'</span><br>病症：<span id="disease1'+o+'">'+data[o].reason+'</span><br>患者Id：<span id="patientId'+o+'">'+data[o].patientId+'</span><br>医院：<span id="hospitalId'+o+'">'+data[o].hospitalId+'</span></br>日期：<span id="date'+o+'">'+data[o].date+'</span><button class="btn btn-default pull-right" id="'+o+'" onclick="apply(this)">申请查看</button></br></hr>').appendTo("#searchResult");
                    }
                    if(jsonLength==0){
                      $("#searchResult").html("暂无满足要求的数据,情稍后再试");
                    }
                }
                }).error(function(err){
                    console.log(err);
                    alert(err.responseText);
                  });
               });
            </script>
            </div>
          </div>
        <div class="container block1"><h1>A</h1>
       <h1>A</h1>
      </div>
        </div>
      </div>
      </div>
		<!-- END fh5co-services-section -->		
		<!-- fh5co-blog-section -->
		<div id="footer">
    <div class="container">
     <div class="row">
      <div class="col-md-6 col-md-offset-3 text-center">
       <p>Medical Blockchain<a href=" " title="关于我们">About us</a ></br>医疗区块链@copyright 2017/05/14</p >
      </div>
     </div>
    </div>
   </div>
  </footer>
	</div>
	<!-- END fh5co-page -->

	</div>
	<!-- END fh5co-wrapper -->

  <script type="text/javascript">
      function apply(obj){
         var num=obj.id;
         // data(id);
        $('#'+num+'').replaceWith('<span class="pull-right" style="color:#7ad88f;">请求成功，等待受理……</span>');
        var istr="#_id"+num;
        var pstr="#patientId"+num;
        var hstr="#hospitalId"+num;
        var thisURL = document.URL;    
        var getval =thisURL.split('?')[1];  
        var reason= getval.split("=")[1];
        var postBody = {
            coreDataId: $(istr).html(),
            patientId: $(pstr).html(),
            hospitalId: $(hstr).html(),
            reason: getval.split("=")[1],
            applicationId:$("#mtname").html()
            };
        console.log(JSON.stringify(postBody));
        $.ajax({
            type: 'POST',
            url: 'http://localhost:3389/check/third/app',
            data: postBody,
            dataType: 'json',
            success: function(data){ 
              var jsonstr=JSON.stringify(data);   
              alert("请求成功！正在等待受理");    
              console.log("data success"+jsonstr);

            }
         }).error(function(err){
            console.log(err);
            alert("服务器忙！请稍后再尝试");
          });
      }
        function login_out(){
      delCookie(getCookie("name"));
      setTimeout("window.location.href='login.html'",1000);
    }
    function delCookie(name){//为了删除指定名称的cookie，可以将其过期时间设定为一个过去的时间   
    var date = new Date();   
    date.setTime(date.getTime() - 10000);   
    document.cookie = name + "=a; expires=" + date.toGMTString();   
} 
  </script>      
	</body>
</html>

